import pandas as pd

input_file = r"C:\Users\Eric\Desktop\Novus Initium\Ars Discendi\TFG\ROSTER_19Apr2025.csv"

#Lista de las RID de los 819 pacientes del estudio DigitalHealth

rids = [
    2, 5, 8, 14, 15, 16, 19, 21, 22, 23, 31, 35, 40, 43, 47, 48, 55, 56, 58, 59, 61, 66, 67, 68, 69, 70, 72, 74, 81, 86,
    89, 90, 95, 96, 97, 106, 113, 118, 120, 123, 125, 127, 130, 156, 159, 166, 171, 172, 173, 177, 184, 186, 196, 210, 223,
    229, 230, 232, 245, 257, 259, 260, 262, 272, 283, 295, 298, 301, 303, 304, 311, 312, 315, 319, 327, 337, 352, 359, 360,
    363, 369, 382, 386, 403, 405, 413, 416, 419, 420, 425, 433, 436, 441, 454, 459, 467, 472, 473, 479, 484, 488, 489, 493,
    498, 500, 502, 506, 516, 519, 520, 522, 525, 526, 533, 534, 538, 545, 548, 553, 555, 558, 559, 575, 576, 578, 601, 602,
    605, 610, 618, 622, 637, 640, 643, 647, 648, 657, 672, 677, 680, 681, 684, 685, 686, 692, 711, 717, 726, 731, 734, 741,
    751, 761, 767, 768, 778, 779, 810, 813, 818, 824, 842, 843, 845, 862, 863, 866, 876, 883, 886, 896, 898, 899, 907, 920,
    923, 926, 931, 934, 951, 963, 967, 969, 972, 981, 984, 985, 1002, 1009, 1013, 1014, 1016, 1021, 1023, 1035, 1063, 1086,
    1094, 1098, 1099, 1123, 1133, 1169, 1190, 1191, 1194, 1195, 1197, 1200, 1202, 1203, 1206, 1212, 1222, 1232, 1241, 1242,
    1249, 1250, 1251, 1256, 1261, 1267, 1276, 1280, 1286, 1288, 1301, 1306, 4, 6, 30, 33, 38, 41, 42, 44, 45, 50, 51, 54,
    57, 60, 77, 78, 80, 87, 98, 101, 102, 103, 107, 108, 111, 112, 116, 126, 128, 135, 138, 141, 142, 150, 155, 158, 160,
    161, 168, 169, 176, 178, 179, 182, 187, 188, 190, 195, 200, 204, 205, 214, 217, 222, 225, 227, 231, 240, 241, 243, 249,
    256, 258, 269, 273, 276, 282, 284, 285, 288, 289, 290, 291, 292, 293, 294, 296, 307, 314, 324, 325, 326, 331, 332, 336,
    339, 344, 351, 354, 361, 362, 376, 377, 378, 384, 388, 389, 390, 393, 394, 397, 401, 406, 407, 408, 409, 410, 414, 417,
    422, 423, 424, 429, 434, 442, 443, 445, 446, 448, 449, 450, 458, 461, 464, 469, 476, 478, 481, 485, 501, 505, 507, 511,
    513, 514, 518, 531, 539, 544, 546, 549, 551, 552, 557, 563, 566, 567, 568, 572, 579, 588, 590, 598, 604, 607, 608, 611,
    613, 621, 625, 626, 629, 631, 634, 638, 641, 644, 649, 656, 658, 667, 668, 669, 671, 673, 675, 679, 695, 697, 698, 702,
    708, 709, 715, 718, 721, 722, 723, 725, 727, 729, 746, 748, 750, 752, 769, 770, 771, 782, 783, 792, 800, 802, 821, 825,
    830, 832, 834, 835, 839, 851, 855, 856, 860, 861, 865, 867, 869, 871, 872, 873, 874, 878, 880, 887, 890, 892, 904, 906,
    908, 909, 912, 913, 914, 915, 917, 919, 921, 922, 924, 925, 928, 930, 932, 941, 945, 947, 950, 952, 954, 957, 958, 961,
    973, 976, 978, 982, 987, 989, 994, 995, 997, 1004, 1007, 1010, 1015, 1028, 1030, 1031, 1032, 1033, 1034, 1038, 1040,
    1043, 1045, 1046, 1051, 1052, 1054, 1057, 1066, 1070, 1072, 1073, 1074, 1075, 1077, 1078, 1080, 1088, 1092, 1097, 1103,
    1104, 1106, 1114, 1116, 1117, 1118, 1119, 1120, 1121, 1122, 1126, 1130, 1131, 1135, 1138, 1140, 1148, 1149, 1154, 1155,
    1165, 1168, 1175, 1182, 1183, 1186, 1187, 1188, 1199, 1204, 1210, 1211, 1213, 1215, 1217, 1218, 1224, 1225, 1226, 1227,
    1231, 1240, 1243, 1244, 1245, 1246, 1247, 1255, 1260, 1265, 1268, 1269, 1271, 1275, 1277, 1279, 1282, 1284, 1292, 1293,
    1294, 1295, 1299, 1300, 1309, 1311, 1314, 1315, 1318, 1321, 1322, 1326, 1330, 1331, 1338, 1340, 1343, 1346, 1350, 1351,
    1352, 1357, 1363, 1366, 1378, 1380, 1384, 1387, 1389, 1393, 1394, 1398, 1400, 1406, 1407, 1408, 1411, 1412, 1414, 1417,
    1418, 1419, 1420, 1421, 1423, 1425, 1426, 1427, 3, 7, 10, 29, 53, 76, 83, 84, 88, 91, 93, 94, 109, 110, 129, 139, 147,
    149, 162, 167, 183, 194, 213, 216, 219, 221, 228, 266, 286, 299, 300, 310, 316, 321, 328, 335, 341, 343, 356, 366, 370,
    372, 374, 392, 400, 404, 426, 431, 438, 457, 470, 474, 487, 492, 497, 517, 528, 535, 543, 547, 554, 565, 577, 592, 606,
    619, 627, 633, 642, 653, 682, 689, 690, 691, 696, 699, 712, 720, 724, 730, 733, 739, 740, 743, 747, 753, 754, 759, 760,
    777, 784, 786, 790, 793, 796, 803, 812, 814, 816, 828, 829, 836, 841, 844, 850, 852, 853, 884, 889, 891, 916, 929, 938,
    955, 956, 979, 991, 996, 999, 1001, 1018, 1024, 1027, 1037, 1041, 1044, 1055, 1056, 1059, 1062, 1079, 1081, 1082, 1083,
    1090, 1095, 1101, 1102, 1109, 1113, 1137, 1144, 1152, 1157, 1161, 1164, 1170, 1171, 1184, 1185, 1192, 1201, 1205, 1209,
    1221, 1248, 1253, 1254, 1257, 1262, 1263, 1281, 1283, 1285, 1289, 1290, 1296, 1304, 1307, 1308, 1334, 1337, 1339, 1341,
    1354, 1368, 1371, 1373, 1377, 1379, 1382, 1385, 1391, 1397, 1402, 1409, 1430, 1435
]


print(len(rids))

df = pd.read_csv(input_file)

filtered_df = df[(df["RID"].isin(rids)) & (df.iloc[:, 0] == "ADNI1")]

filtered_df = filtered_df.drop_duplicates()
filtered_df.to_csv(r"C:\Users\Eric\Desktop\Novus Initium\Ars Discendi\TFG\TFG_ADNI.csv", index=False)
ptid_list = filtered_df["PTID"].tolist()
ptid_text = ",".join(ptid_list)

# Guardamos en un TXT para visualizar los datos posteriormente
with open(r"C:\Users\Eric\Desktop\Novus Initium\Ars Discendi\TFG\TFG_PTID.txt", "w") as f:
    f.write(ptid_text)

print("Archivo filtrado guardado como TFG_ADNI.csv")
print("Archivo de PTIDs guardado como TFG_PTID.txt")



print("Buscamos coincidencias")

# Cargar tus datos filtrados
filtered_csv= pd.read_csv(r"C:\Users\Eric\Desktop\Novus Initium\Ars Discendi\TFG\TFG_ADNI.csv")

# Cargar el segundo archivo
adni1_df = pd.read_csv(r"C:\Users\Eric\Desktop\Novus Initium\Ars Discendi\TFG\ADNI1_Complete_1Yr_1.5T_4_26_2025.csv")

adni1_sc_df = adni1_df[adni1_df["Visit"] == "sc"]

# Extraemos las listas de PTID
filtered_ptids = set(filtered_df["PTID"])
print("PTID MIOS")

print(len(filtered_ptids))
adni1_ptids = set(adni1_sc_df["Subject"])
print(len(adni1_ptids))


# Buscamos las  coincidencias
coincidencias = filtered_ptids.intersection(adni1_ptids)

print(f"Número de PTIDs coincidentes: {len(coincidencias)}")


# Buscamos los PTID que no están en el archivo ADNI1
adni1_ptid_list = adni1_sc_df["Subject"].tolist()

# Comparamos los PTID de tus datos filtrados con los de ADNI1
non_matching_ptids = [ptid for ptid in ptid_list if ptid not in adni1_ptid_list]

print(f"Número de PTIDs NO coincidentes: {len(non_matching_ptids)}")


# Guardamos los PTID no coincidentes en un archivo de texto
non_matching_text = ",".join(map(str, non_matching_ptids))

with open(r"C:\Users\Eric\Desktop\Novus Initium\Ars Discendi\TFG\Non_Matching_PTID.txt", "w") as f:
    f.write(non_matching_text)

print("Archivo de PTIDs no coincidentes guardado como Non_Matching_PTID.txt")
